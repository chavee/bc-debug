var _=require("/alloy/underscore")._,
backbone=require("/alloy/backbone"),



ALLOY_DB_DEFAULT="_alloy_",
ALLOY_ID_DEFAULT="alloy_id";

function S4(){
return(0|65536*(1+Math.random())).toString(16).substring(1);
}

function guid(){
return S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4();
}

var cache={
config:{},
Model:{},
db:{}};


function getDatabase(name){



return cache.db[name]||(cache.db[name]=Ti.Database.open(name)),cache.db[name];
}












function Migrator(config,transactionDb){
this.db=transactionDb,
this.dbname=config.adapter.db_name,
this.table=config.adapter.collection_name,
this.idAttribute=config.adapter.idAttribute,


this.column=function(name){var


parts=name.split(/\s+/),
type=parts[0];
switch(type.toLowerCase()){
case"string":
case"varchar":
case"date":
case"datetime":
Ti.API.warn("\""+type+"\" is not a valid sqlite field, using TEXT instead");
case"text":
type="TEXT";
break;
case"int":
case"tinyint":
case"smallint":
case"bigint":
case"boolean":
Ti.API.warn("\""+type+"\" is not a valid sqlite field, using INTEGER instead");
case"integer":
type="INTEGER";
break;
case"double":
case"float":
case"decimal":
case"number":
Ti.API.warn("\""+name+"\" is not a valid sqlite field, using REAL instead");
case"real":
type="REAL";
break;
case"blob":
type="BLOB";
break;
case"null":
type="NULL";
break;
default:
type="TEXT";}



return parts[0]=type,parts.join(" ");
},

this.createTable=function(config){var

columns=[],
found=!1;
for(var k in config.columns)
k===this.idAttribute&&(found=!0),
columns.push(k+" "+this.column(config.columns[k]));



found||this.idAttribute!==ALLOY_ID_DEFAULT||
columns.push(ALLOY_ID_DEFAULT+" TEXT UNIQUE");

var sql="CREATE TABLE IF NOT EXISTS "+this.table+" ( "+columns.join(",")+")";


this.db.execute(sql);
},

this.dropTable=function(){
this.db.execute("DROP TABLE IF EXISTS "+this.table);
},

this.insertRow=function(columnValues){var
columns=[],
values=[],
qs=[],


found=!1;
for(var key in columnValues)
key===this.idAttribute&&(found=!0),
columns.push(key),
values.push(columnValues[key]),
qs.push("?");



found||this.idAttribute!==ALLOY_ID_DEFAULT||(
columns.push(this.idAttribute),
values.push(guid()),
qs.push("?")),



this.db.execute("INSERT INTO "+this.table+" ("+columns.join(",")+") VALUES ("+qs.join(",")+");",values);
},

this.deleteRow=function(columns){var
sql="DELETE FROM "+this.table,
keys=_.keys(columns),
len=keys.length,
conditions=[],
values=[];


len&&(sql+=" WHERE ");
for(var i=0;i<len;i++)
conditions.push(keys[i]+" = ?"),
values.push(columns[keys[i]]);

sql+=conditions.join(" AND "),


this.db.execute(sql,values);
};
}

function Sync(method,model,opts){
var



db,sql,table=model.config.adapter.collection_name,columns=model.config.columns,dbName=model.config.adapter.db_name||ALLOY_DB_DEFAULT,resp=null;

switch(method){
case"create":
case"update":
resp=function(){
var attrObj={};

model.id||(
model.id=model.idAttribute===ALLOY_ID_DEFAULT?guid():null,
attrObj[model.idAttribute]=model.id,
"0.9.2"===backbone.VERSION?model.set(attrObj,{silent:!0}):model.set(attrObj));



var names=[],values=[],q=[];
for(var k in columns)
names.push(k),
values.push(model.get(k)),
q.push("?");














return sql="REPLACE INTO "+table+" ("+names.join(",")+") VALUES ("+q.join(",")+");",db=getDatabase(dbName),db.execute(sql,values),null===model.id&&(model.id=db.lastInsertRowId,attrObj[model.idAttribute]=model.id,"0.9.2"===backbone.VERSION?model.set(attrObj,{silent:!0}):model.set(attrObj)),model.toJSON();
}();
break;

case"read":

opts.query&&opts.id&&
Ti.API.warn("Both \"query\" and \"id\" options were specified for model.fetch(). \"id\" will be ignored."),



sql="SELECT * FROM "+table,
opts.query?
sql=opts.query:
opts.id&&(
sql+=" WHERE "+(model.idAttribute?model.idAttribute:ALLOY_ID_DEFAULT)+" = "+(_.isString(opts.id)?"\""+opts.id+"\"":opts.id)),



db=getDatabase(dbName);
var rs;



rs=_.isString(sql)?db.execute(sql):

db.execute(sql.statement,sql.params);







for(var values=[],fieldNames=[],fieldCount=_.isFunction(rs.fieldCount)?rs.fieldCount():rs.fieldCount,i=0;i<fieldCount;i++)
fieldNames.push(rs.fieldName(i));for(;



rs.isValidRow();){
var o={};
for(i=0;i<fieldCount;i++)
o[fieldNames[i]]=rs.field(i);

values.push(o),
rs.next();
}
rs.close();


var len=values.length;

"0.9.2"===backbone.VERSION&&(
model.length=len),


resp=1===len?values[0]:values;
break;

case"delete":
sql="DELETE FROM "+table+" WHERE "+model.idAttribute+"=?",


db=getDatabase(dbName),
db.execute(sql,model.id),

resp=model.toJSON();}




resp?(
_.isFunction(opts.success)&&opts.success(resp),
"read"===method&&!opts.silent&&model.trigger("fetch",{fromAdapter:!0})):

_.isFunction(opts.error)&&opts.error(resp);


}


function GetMigrationFor(dbname,table){var
mid=null,
db=getDatabase(dbname);
db.execute("CREATE TABLE IF NOT EXISTS migrations (latest TEXT, model TEXT);");
var rs=db.execute("SELECT latest FROM migrations where model = ?;",table);




return rs.isValidRow()&&(mid=rs.field(0)+""),rs.close(),mid;
}

function Migrate(Model){var

migrations=Model.migrations||[],


lastMigration={};
migrations.length&&migrations[migrations.length-1](lastMigration);


var config=Model.prototype.config;


config.adapter.db_name=config.adapter.db_name||ALLOY_DB_DEFAULT;var
migrator=new Migrator(config),





targetNumber="undefined"==typeof config.adapter.migration||
null===config.adapter.migration?lastMigration.id:config.adapter.migration;
if("undefined"==typeof targetNumber||null===targetNumber){
var tmpDb=getDatabase(config.adapter.db_name);


return migrator.db=tmpDb,void migrator.createTable(config);
}
targetNumber+="";var







direction,currentNumber=GetMigrationFor(config.adapter.db_name,config.adapter.collection_name);
if(currentNumber!==targetNumber){

currentNumber&&currentNumber>targetNumber?(
direction=0,
migrations.reverse()):

direction=1;



var db=getDatabase(config.adapter.db_name);





if(migrator.db=db,db.execute("BEGIN;"),migrations.length)
for(var i=0;i<migrations.length;i++){var

migration=migrations[i],
context={};




if(migration(context),direction){
if(context.id>targetNumber)break;
if(context.id<=currentNumber)continue;
}else{
if(context.id<=targetNumber)break;
if(context.id>currentNumber)continue;
}


var funcName=direction?"up":"down";
_.isFunction(context[funcName])&&
context[funcName](migrator,config);

}else

migrator.createTable(config);



db.execute("DELETE FROM migrations where model = ?",config.adapter.collection_name),
db.execute("INSERT INTO migrations VALUES (?,?)",targetNumber,config.adapter.collection_name),


db.execute("COMMIT;"),
migrator.db=null}
}

function installDatabase(config){var

dbFile=_.isFunction(config.adapter.db_file)?config.adapter.db_file(config):config.adapter.db_file,
table=config.adapter.collection_name,

rx=/(^|.*\/)([^\/]+)\.[^\/]+$/,
match=dbFile.match(rx);
if(null===match)
throw"Invalid sql database filename \""+dbFile+"\"";


config.adapter.db_name=config.adapter.db_name||match[2];
var dbName=config.adapter.db_name;


Ti.API.debug("Installing sql database \""+dbFile+"\" with name \""+dbName+"\"");
var db=Ti.Database.install(dbFile,dbName);
cache.db[dbName]=db,


!1!==config.adapter.remoteBackup||1||(
Ti.API.debug("iCloud \"do not backup\" flag set for database \""+dbFile+"\""),
db.file.setRemoteBackup(!1));var




cName,cType,rs=db.execute("pragma table_info(\""+table+"\");"),columns={};
if(rs){for(;
rs.isValidRow();)
cName=rs.fieldByName("name"),
cType=rs.fieldByName("type"),
columns[cName]=cType,


cName!==ALLOY_ID_DEFAULT||config.adapter.idAttribute||(
config.adapter.idAttribute=ALLOY_ID_DEFAULT),


rs.next();

rs.close();
}
if(0===Object.keys(columns).length){
var idAttribute=config.adapter.idAttribute?config.adapter.idAttribute:ALLOY_ID_DEFAULT;
for(var k in config.columns)
cName=k,
cType=config.columns[k],


cName!==ALLOY_ID_DEFAULT||config.adapter.idAttribute?

k===config.adapter.idAttribute&&(
cType+=" UNIQUE"):config.adapter.idAttribute=ALLOY_ID_DEFAULT,

columns[cName]=cType;

}



if(config.columns=columns,!config.adapter.idAttribute)




{
Ti.API.info("No config.adapter.idAttribute specified for table \""+table+"\""),
Ti.API.info("Adding \""+ALLOY_ID_DEFAULT+"\" to uniquely identify rows");

var fullStrings=[],
colStrings=[];
_.each(config.columns,function(type,name){
colStrings.push(name),
fullStrings.push(name+" "+type);
});
var colsString=colStrings.join(",");
db.execute("ALTER TABLE "+table+" RENAME TO "+table+"_temp;"),
db.execute("CREATE TABLE "+table+"("+fullStrings.join(",")+","+ALLOY_ID_DEFAULT+" TEXT UNIQUE);"),
db.execute("INSERT INTO "+table+"("+colsString+","+ALLOY_ID_DEFAULT+") SELECT "+colsString+",CAST(_ROWID_ AS TEXT) FROM "+table+"_temp;"),
db.execute("DROP TABLE "+table+"_temp;"),
config.columns[ALLOY_ID_DEFAULT]="TEXT UNIQUE",
config.adapter.idAttribute=ALLOY_ID_DEFAULT;
}else if(!_.contains(_.keys(config.columns),config.adapter.idAttribute))throw"config.adapter.idAttribute \""+config.adapter.idAttribute+"\" not found in list of columns for table \""+table+"\"\ncolumns: ["+_.keys(config.columns).join(",")+"]";
}

module.exports.beforeModelCreate=function(config,name){

if(cache.config[name])
return cache.config[name];



if("undefined"==typeof Ti.Database)
throw"No support for Titanium.Database in MobileWeb environment.";














return config.adapter.db_file&&installDatabase(config),config.adapter.idAttribute||(Ti.API.info("No config.adapter.idAttribute specified for table \""+config.adapter.collection_name+"\""),Ti.API.info("Adding \""+ALLOY_ID_DEFAULT+"\" to uniquely identify rows"),config.columns[ALLOY_ID_DEFAULT]="TEXT UNIQUE",config.adapter.idAttribute=ALLOY_ID_DEFAULT),cache.config[name]=config,config;
},

module.exports.afterModelCreate=function(Model,name){return(

cache.Model[name]?
cache.Model[name]:(



Model=Model||{},
Model.prototype.idAttribute=Model.prototype.config.adapter.idAttribute,
Migrate(Model),


cache.Model[name]=Model,

Model));
},

module.exports.sync=Sync;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNxbC5qcyJdLCJuYW1lcyI6WyJfIiwicmVxdWlyZSIsImJhY2tib25lIiwiQUxMT1lfREJfREVGQVVMVCIsIkFMTE9ZX0lEX0RFRkFVTFQiLCJTNCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0cmluZyIsImd1aWQiLCJjYWNoZSIsImNvbmZpZyIsIk1vZGVsIiwiZGIiLCJnZXREYXRhYmFzZSIsIm5hbWUiLCJUaSIsIkRhdGFiYXNlIiwib3BlbiIsIk1pZ3JhdG9yIiwidHJhbnNhY3Rpb25EYiIsImRibmFtZSIsImFkYXB0ZXIiLCJkYl9uYW1lIiwidGFibGUiLCJjb2xsZWN0aW9uX25hbWUiLCJpZEF0dHJpYnV0ZSIsImNvbHVtbiIsInBhcnRzIiwic3BsaXQiLCJ0eXBlIiwidG9Mb3dlckNhc2UiLCJBUEkiLCJ3YXJuIiwiam9pbiIsImNyZWF0ZVRhYmxlIiwiY29sdW1ucyIsImZvdW5kIiwiayIsInB1c2giLCJzcWwiLCJleGVjdXRlIiwiZHJvcFRhYmxlIiwiaW5zZXJ0Um93IiwiY29sdW1uVmFsdWVzIiwidmFsdWVzIiwicXMiLCJrZXkiLCJkZWxldGVSb3ciLCJrZXlzIiwibGVuIiwibGVuZ3RoIiwiY29uZGl0aW9ucyIsImkiLCJTeW5jIiwibWV0aG9kIiwibW9kZWwiLCJvcHRzIiwiZGJOYW1lIiwicmVzcCIsImF0dHJPYmoiLCJpZCIsIlZFUlNJT04iLCJzZXQiLCJzaWxlbnQiLCJuYW1lcyIsInEiLCJnZXQiLCJsYXN0SW5zZXJ0Um93SWQiLCJ0b0pTT04iLCJxdWVyeSIsImlzU3RyaW5nIiwicnMiLCJzdGF0ZW1lbnQiLCJwYXJhbXMiLCJmaWVsZE5hbWVzIiwiZmllbGRDb3VudCIsImlzRnVuY3Rpb24iLCJmaWVsZE5hbWUiLCJpc1ZhbGlkUm93IiwibyIsImZpZWxkIiwibmV4dCIsImNsb3NlIiwic3VjY2VzcyIsInRyaWdnZXIiLCJmcm9tQWRhcHRlciIsImVycm9yIiwiR2V0TWlncmF0aW9uRm9yIiwibWlkIiwiTWlncmF0ZSIsIm1pZ3JhdGlvbnMiLCJsYXN0TWlncmF0aW9uIiwicHJvdG90eXBlIiwibWlncmF0b3IiLCJ0YXJnZXROdW1iZXIiLCJtaWdyYXRpb24iLCJ0bXBEYiIsImRpcmVjdGlvbiIsImN1cnJlbnROdW1iZXIiLCJyZXZlcnNlIiwiY29udGV4dCIsImZ1bmNOYW1lIiwiaW5zdGFsbERhdGFiYXNlIiwiZGJGaWxlIiwiZGJfZmlsZSIsInJ4IiwibWF0Y2giLCJkZWJ1ZyIsImluc3RhbGwiLCJyZW1vdGVCYWNrdXAiLCJmaWxlIiwic2V0UmVtb3RlQmFja3VwIiwiY05hbWUiLCJjVHlwZSIsImZpZWxkQnlOYW1lIiwiT2JqZWN0IiwiaW5mbyIsImZ1bGxTdHJpbmdzIiwiY29sU3RyaW5ncyIsImVhY2giLCJjb2xzU3RyaW5nIiwiY29udGFpbnMiLCJtb2R1bGUiLCJleHBvcnRzIiwiYmVmb3JlTW9kZWxDcmVhdGUiLCJhZnRlck1vZGVsQ3JlYXRlIiwic3luYyJdLCJtYXBwaW5ncyI6IkdBQUlBLENBQUFBLENBQUMsQ0FBR0MsT0FBTyxDQUFDLG1CQUFELENBQVAsQ0FBNkJELEM7QUFDckNFLFFBQVEsQ0FBR0QsT0FBTyxDQUFDLGlCQUFELEM7Ozs7QUFJZEUsZ0JBQWdCLENBQUcsUztBQUNuQkMsZ0JBQWdCLENBQUcsVTs7QUFFdkIsUUFBU0MsQ0FBQUEsRUFBVCxFQUFjO0FBQ1osTUFBTyxDQUFpQyxDQUFoQyxDQUFzQixLQUF0QixFQUFDLEVBQUlDLElBQUksQ0FBQ0MsTUFBTCxFQUFMLENBQUQsRUFBb0NDLFFBQXBDLENBQTZDLEVBQTdDLEVBQWlEQyxTQUFqRCxDQUEyRCxDQUEzRCxDQUFQO0FBQ0Q7O0FBRUQsUUFBU0MsQ0FBQUEsSUFBVCxFQUFnQjtBQUNkLE1BQU9MLENBQUFBLEVBQUUsR0FBS0EsRUFBRSxFQUFULENBQWMsR0FBZCxDQUFvQkEsRUFBRSxFQUF0QixDQUEyQixHQUEzQixDQUFpQ0EsRUFBRSxFQUFuQyxDQUF3QyxHQUF4QyxDQUE4Q0EsRUFBRSxFQUFoRCxDQUFxRCxHQUFy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ZGdEO0FBZXhELEM7O0FBRUQrRyxNQUFNLENBQUNDLE9BQVAsQ0FBZUcsSUFBZixDQUFzQnpFLEkiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgXyA9IHJlcXVpcmUoJy9hbGxveS91bmRlcnNjb3JlJykuXyxcbmJhY2tib25lID0gcmVxdWlyZSgnL2FsbG95L2JhY2tib25lJyk7XG5cbi8vIFRoZSBkYXRhYmFzZSBuYW1lIHVzZWQgd2hlbiBub25lIGlzIHNwZWNpZmllZCBpbiB0aGVcbi8vIG1vZGVsIGNvbmZpZ3VyYXRpb24uXG52YXIgQUxMT1lfREJfREVGQVVMVCA9ICdfYWxsb3lfJztcbnZhciBBTExPWV9JRF9ERUZBVUxUID0gJ2FsbG95X2lkJztcblxuZnVuY3Rpb24gUzQoKSB7XG4gIHJldHVybiAoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDAgfCAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpO1xufVxuXG5mdW5jdGlvbiBndWlkKCkge1xuICByZXR1cm4gUzQoKSArIFM0KCkgKyAnLScgKyBTNCgpICsgJy0nICsgUzQoKSArICctJyArIFM0KCkgKyAnLScgKyBTNCgpICsgUzQoKSArIFM0KCk7XG59XG5cbnZhciBjYWNoZSA9IHtcbiAgY29uZmlnOiB7fSxcbiAgTW9kZWw6IHt9LFxuICBkYjoge30gfTtcblxuXG5mdW5jdGlvbiBnZXREYXRhYmFzZShuYW1lKSB7XG4gIGlmICghY2FjaGUuZGJbbmFtZV0pIHtcbiAgICBjYWNoZS5kYltuYW1lXSA9IFRpLkRhdGFiYXNlLm9wZW4obmFtZSk7XG4gIH1cbiAgcmV0dXJuIGNhY2hlLmRiW25hbWVdO1xufVxuXG4vLyBUaGUgc3FsLXNwZWNpZmljIG1pZ3JhdGlvbiBvYmplY3QsIHdoaWNoIGlzIHRoZSBtYWluIHBhcmFtZXRlclxuLy8gdG8gdGhlIHVwKCkgYW5kIGRvd24oKSBtaWdyYXRpb24gZnVuY3Rpb25zLlxuLy9cbi8vIGRiICAgICAgICAgICAgVGhlIGRhdGFiYXNlIGhhbmRsZSBmb3IgbWlncmF0aW9uIHByb2Nlc3NpbmcuIERvIG5vdCBvcGVuXG4vLyAgICAgICAgICAgICAgIG9yIGNsb3NlIHRoaXMgYXMgaXQgaXMgYSBydW5uaW5nIHRyYW5zYWN0aW9uIHRoYXQgZW5zdXJlc1xuLy8gICAgICAgICAgICAgICBkYXRhIGludGVncml0eSBkdXJpbmcgdGhlIG1pZ3JhdGlvbiBwcm9jZXNzLlxuLy8gZGJuYW1lICAgICAgICBUaGUgbmFtZSBvZiB0aGUgU1FMaXRlIGRhdGFiYXNlIGZvciB0aGlzIG1vZGVsLlxuLy8gdGFibGUgICAgICAgICBUaGUgbmFtZSBvZiB0aGUgU1FMaXRlIHRhYmxlIGZvciB0aGlzIG1vZGVsLlxuLy8gaWRBdHRyaWJ1dGUgICBUaGUgdW5pcXVlIElEIGNvbHVtbiBmb3IgdGhpcyBtb2RlbCwgd2hpY2ggaXNcbi8vICAgICAgICAgICAgICAgbWFwcGVkIGJhY2sgdG8gQmFja2JvbmUuanMgZm9yIGl0cyB1cGRhdGUgYW5kXG4vLyAgICAgICAgICAgICAgIGRlbGV0ZSBvcGVyYXRpb25zLlxuZnVuY3Rpb24gTWlncmF0b3IoY29uZmlnLCB0cmFuc2FjdGlvbkRiKSB7XG4gIHRoaXMuZGIgPSB0cmFuc2FjdGlvbkRiO1xuICB0aGlzLmRibmFtZSA9IGNvbmZpZy5hZGFwdGVyLmRiX25hbWU7XG4gIHRoaXMudGFibGUgPSBjb25maWcuYWRhcHRlci5jb2xsZWN0aW9uX25hbWU7XG4gIHRoaXMuaWRBdHRyaWJ1dGUgPSBjb25maWcuYWRhcHRlci5pZEF0dHJpYnV0ZTtcblxuICAvL1RPRE86IG5vcm1hbGl6ZSBjb2x1bW5zIGF0IGNvbXBpbGUgdGltZSAtIGh0dHBzOi8vamlyYS5hcHBjZWxlcmF0b3Iub3JnL2Jyb3dzZS9BTE9ZLTIyMlxuICB0aGlzLmNvbHVtbiA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgLy8gc3BsaXQgaW50byBwYXJ0cyB0byBrZWVwIGFkZGl0aW9uYWwgY29sdW1uIGNoYXJhY3RlcmlzdGljcyBsaWtlXG4gICAgLy8gYXV0b2luY3JlbWVudCwgcHJpbWFyeSBrZXksIGV0Yy4uLlxuICAgIHZhciBwYXJ0cyA9IG5hbWUuc3BsaXQoL1xccysvKTtcbiAgICB2YXIgdHlwZSA9IHBhcnRzWzBdO1xuICAgIHN3aXRjaCAodHlwZS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgY2FzZSAndmFyY2hhcic6XG4gICAgICBjYXNlICdkYXRlJzpcbiAgICAgIGNhc2UgJ2RhdGV0aW1lJzpcbiAgICAgICAgVGkuQVBJLndhcm4oJ1wiJyArIHR5cGUgKyAnXCIgaXMgbm90IGEgdmFsaWQgc3FsaXRlIGZpZWxkLCB1c2luZyBURVhUIGluc3RlYWQnKTtcbiAgICAgIGNhc2UgJ3RleHQnOlxuICAgICAgICB0eXBlID0gJ1RFWFQnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2ludCc6XG4gICAgICBjYXNlICd0aW55aW50JzpcbiAgICAgIGNhc2UgJ3NtYWxsaW50JzpcbiAgICAgIGNhc2UgJ2JpZ2ludCc6XG4gICAgICBjYXNlICdib29sZWFuJzpcbiAgICAgICAgVGkuQVBJLndhcm4oJ1wiJyArIHR5cGUgKyAnXCIgaXMgbm90IGEgdmFsaWQgc3FsaXRlIGZpZWxkLCB1c2luZyBJTlRFR0VSIGluc3RlYWQnKTtcbiAgICAgIGNhc2UgJ2ludGVnZXInOlxuICAgICAgICB0eXBlID0gJ0lOVEVHRVInO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2RvdWJsZSc6XG4gICAgICBjYXNlICdmbG9hdCc6XG4gICAgICBjYXNlICdkZWNpbWFsJzpcbiAgICAgIGNhc2UgJ251bWJlcic6XG4gICAgICAgIFRpLkFQSS53YXJuKCdcIicgKyBuYW1lICsgJ1wiIGlzIG5vdCBhIHZhbGlkIHNxbGl0ZSBmaWVsZCwgdXNpbmcgUkVBTCBpbnN0ZWFkJyk7XG4gICAgICBjYXNlICdyZWFsJzpcbiAgICAgICAgdHlwZSA9ICdSRUFMJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdibG9iJzpcbiAgICAgICAgdHlwZSA9ICdCTE9CJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdudWxsJzpcbiAgICAgICAgdHlwZSA9ICdOVUxMJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0eXBlID0gJ1RFWFQnO1xuICAgICAgICBicmVhazt9XG5cbiAgICBwYXJ0c1swXSA9IHR5cGU7XG4gICAgcmV0dXJuIHBhcnRzLmpvaW4oJyAnKTtcbiAgfTtcblxuICB0aGlzLmNyZWF0ZVRhYmxlID0gZnVuY3Rpb24gKGNvbmZpZykge1xuICAgIC8vIGNvbXBvc2UgdGhlIGNyZWF0ZSBxdWVyeVxuICAgIHZhciBjb2x1bW5zID0gW107XG4gICAgdmFyIGZvdW5kID0gZmFsc2U7XG4gICAgZm9yICh2YXIgayBpbiBjb25maWcuY29sdW1ucykge1xuICAgICAgaWYgKGsgPT09IHRoaXMuaWRBdHRyaWJ1dGUpIHtmb3VuZCA9IHRydWU7fVxuICAgICAgY29sdW1ucy5wdXNoKGsgKyAnICcgKyB0aGlzLmNvbHVtbihjb25maWcuY29sdW1uc1trXSkpO1xuICAgIH1cblxuICAgIC8vIGFkZCB0aGUgaWQgZmllbGQgaWYgaXQgd2Fzbid0IHNwZWNpZmllZFxuICAgIGlmICghZm91bmQgJiYgdGhpcy5pZEF0dHJpYnV0ZSA9PT0gQUxMT1lfSURfREVGQVVMVCkge1xuICAgICAgY29sdW1ucy5wdXNoKEFMTE9ZX0lEX0RFRkFVTFQgKyAnIFRFWFQgVU5JUVVFJyk7XG4gICAgfVxuICAgIHZhciBzcWwgPSAnQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgJyArIHRoaXMudGFibGUgKyAnICggJyArIGNvbHVtbnMuam9pbignLCcpICsgJyknO1xuXG4gICAgLy8gZXhlY3V0ZSB0aGUgY3JlYXRlXG4gICAgdGhpcy5kYi5leGVjdXRlKHNxbCk7XG4gIH07XG5cbiAgdGhpcy5kcm9wVGFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5kYi5leGVjdXRlKCdEUk9QIFRBQkxFIElGIEVYSVNUUyAnICsgdGhpcy50YWJsZSk7XG4gIH07XG5cbiAgdGhpcy5pbnNlcnRSb3cgPSBmdW5jdGlvbiAoY29sdW1uVmFsdWVzKSB7XG4gICAgdmFyIGNvbHVtbnMgPSBbXTtcbiAgICB2YXIgdmFsdWVzID0gW107XG4gICAgdmFyIHFzID0gW107XG5cbiAgICAvLyBnZXQgYXJyYXlzIG9mIGNvbHVtbiBuYW1lcywgdmFsdWVzLCBhbmQgdmFsdWUgcGxhY2Vob2xkZXJzXG4gICAgdmFyIGZvdW5kID0gZmFsc2U7XG4gICAgZm9yICh2YXIga2V5IGluIGNvbHVtblZhbHVlcykge1xuICAgICAgaWYgKGtleSA9PT0gdGhpcy5pZEF0dHJpYnV0ZSkge2ZvdW5kID0gdHJ1ZTt9XG4gICAgICBjb2x1bW5zLnB1c2goa2V5KTtcbiAgICAgIHZhbHVlcy5wdXNoKGNvbHVtblZhbHVlc1trZXldKTtcbiAgICAgIHFzLnB1c2goJz8nKTtcbiAgICB9XG5cbiAgICAvLyBhZGQgdGhlIGlkIGZpZWxkIGlmIGl0IHdhc24ndCBzcGVjaWZpZWRcbiAgICBpZiAoIWZvdW5kICYmIHRoaXMuaWRBdHRyaWJ1dGUgPT09IEFMTE9ZX0lEX0RFRkFVTFQpIHtcbiAgICAgIGNvbHVtbnMucHVzaCh0aGlzLmlkQXR0cmlidXRlKTtcbiAgICAgIHZhbHVlcy5wdXNoKGd1aWQoKSk7XG4gICAgICBxcy5wdXNoKCc/Jyk7XG4gICAgfVxuXG4gICAgLy8gY29uc3RydWN0IGFuZCBleGVjdXRlIHRoZSBxdWVyeVxuICAgIHRoaXMuZGIuZXhlY3V0ZSgnSU5TRVJUIElOVE8gJyArIHRoaXMudGFibGUgKyAnICgnICsgY29sdW1ucy5qb2luKCcsJykgKyAnKSBWQUxVRVMgKCcgKyBxcy5qb2luKCcsJykgKyAnKTsnLCB2YWx1ZXMpO1xuICB9O1xuXG4gIHRoaXMuZGVsZXRlUm93ID0gZnVuY3Rpb24gKGNvbHVtbnMpIHtcbiAgICB2YXIgc3FsID0gJ0RFTEVURSBGUk9NICcgKyB0aGlzLnRhYmxlO1xuICAgIHZhciBrZXlzID0gXy5rZXlzKGNvbHVtbnMpO1xuICAgIHZhciBsZW4gPSBrZXlzLmxlbmd0aDtcbiAgICB2YXIgY29uZGl0aW9ucyA9IFtdO1xuICAgIHZhciB2YWx1ZXMgPSBbXTtcblxuICAgIC8vIGNvbnN0cnVjdCB0aGUgd2hlcmUgY2xhdXNlLCBpZiBuZWNlc3NhcnlcbiAgICBpZiAobGVuKSB7c3FsICs9ICcgV0hFUkUgJzt9XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgY29uZGl0aW9ucy5wdXNoKGtleXNbaV0gKyAnID0gPycpO1xuICAgICAgdmFsdWVzLnB1c2goY29sdW1uc1trZXlzW2ldXSk7XG4gICAgfVxuICAgIHNxbCArPSBjb25kaXRpb25zLmpvaW4oJyBBTkQgJyk7XG5cbiAgICAvLyBleGVjdXRlIHRoZSBkZWxldGVcbiAgICB0aGlzLmRiLmV4ZWN1dGUoc3FsLCB2YWx1ZXMpO1xuICB9O1xufVxuXG5mdW5jdGlvbiBTeW5jKG1ldGhvZCwgbW9kZWwsIG9wdHMpIHtcbiAgdmFyIHRhYmxlID0gbW9kZWwuY29uZmlnLmFkYXB0ZXIuY29sbGVjdGlvbl9uYW1lLFxuICBjb2x1bW5zID0gbW9kZWwuY29uZmlnLmNvbHVtbnMsXG4gIGRiTmFtZSA9IG1vZGVsLmNvbmZpZy5hZGFwdGVyLmRiX25hbWUgfHwgQUxMT1lfREJfREVGQVVMVCxcbiAgcmVzcCA9IG51bGwsXG4gIGRiLHNxbDtcblxuICBzd2l0Y2ggKG1ldGhvZCkge1xuICAgIGNhc2UgJ2NyZWF0ZSc6XG4gICAgY2FzZSAndXBkYXRlJzpcbiAgICAgIHJlc3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhdHRyT2JqID0ge307XG5cbiAgICAgICAgaWYgKCFtb2RlbC5pZCkge1xuICAgICAgICAgIG1vZGVsLmlkID0gbW9kZWwuaWRBdHRyaWJ1dGUgPT09IEFMTE9ZX0lEX0RFRkFVTFQgPyBndWlkKCkgOiBudWxsO1xuICAgICAgICAgIGF0dHJPYmpbbW9kZWwuaWRBdHRyaWJ1dGVdID0gbW9kZWwuaWQ7XG4gICAgICAgICAgYmFja2JvbmUuVkVSU0lPTiA9PT0gJzAuOS4yJyA/IG1vZGVsLnNldChhdHRyT2JqLCB7IHNpbGVudDogdHJ1ZSB9KSA6IG1vZGVsLnNldChhdHRyT2JqKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFzc2VtYmxlIGNvbHVtbnMgYW5kIHZhbHVlc1xuICAgICAgICB2YXIgbmFtZXMgPSBbXSx2YWx1ZXMgPSBbXSxxID0gW107XG4gICAgICAgIGZvciAodmFyIGsgaW4gY29sdW1ucykge1xuICAgICAgICAgIG5hbWVzLnB1c2goayk7XG4gICAgICAgICAgdmFsdWVzLnB1c2gobW9kZWwuZ2V0KGspKTtcbiAgICAgICAgICBxLnB1c2goJz8nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGV4ZWN1dGUgdGhlIHF1ZXJ5XG4gICAgICAgIHNxbCA9ICdSRVBMQUNFIElOVE8gJyArIHRhYmxlICsgJyAoJyArIG5hbWVzLmpvaW4oJywnKSArICcpIFZBTFVFUyAoJyArIHEuam9pbignLCcpICsgJyk7JztcbiAgICAgICAgZGIgPSBnZXREYXRhYmFzZShkYk5hbWUpO1xuICAgICAgICBkYi5leGVjdXRlKHNxbCwgdmFsdWVzKTtcblxuICAgICAgICAvLyBpZiBtb2RlbC5pZCBpcyBzdGlsbCBudWxsLCBncmFiIHRoZSBsYXN0IGluc2VydGVkIGlkXG4gICAgICAgIGlmIChtb2RlbC5pZCA9PT0gbnVsbCkge1xuICAgICAgICAgIG1vZGVsLmlkID0gZGIubGFzdEluc2VydFJvd0lkO1xuICAgICAgICAgIGF0dHJPYmpbbW9kZWwuaWRBdHRyaWJ1dGVdID0gbW9kZWwuaWQ7XG4gICAgICAgICAgYmFja2JvbmUuVkVSU0lPTiA9PT0gJzAuOS4yJyA/IG1vZGVsLnNldChhdHRyT2JqLCB7IHNpbGVudDogdHJ1ZSB9KSA6IG1vZGVsLnNldChhdHRyT2JqKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBtb2RlbC50b0pTT04oKTtcbiAgICAgIH0oKTtcbiAgICAgIGJyZWFrO1xuXG4gICAgY2FzZSAncmVhZCc6XG4gICAgICAvLyBwcmludCB3YXJuaW5nIGFib3V0IHVzaW5nIGJvdGggaWQgYW5kIHF1ZXJ5XG4gICAgICBpZiAob3B0cy5xdWVyeSAmJiBvcHRzLmlkKSB7XG4gICAgICAgIFRpLkFQSS53YXJuKCdCb3RoIFwicXVlcnlcIiBhbmQgXCJpZFwiIG9wdGlvbnMgd2VyZSBzcGVjaWZpZWQgZm9yIG1vZGVsLmZldGNoKCkuIFwiaWRcIiB3aWxsIGJlIGlnbm9yZWQuJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIGRldGVybWluZSB0aGUgcXVlcnkgdG8gZXhlY3V0ZVxuICAgICAgc3FsID0gJ1NFTEVDVCAqIEZST00gJyArIHRhYmxlO1xuICAgICAgaWYgKG9wdHMucXVlcnkpIHtcbiAgICAgICAgc3FsID0gb3B0cy5xdWVyeTtcbiAgICAgIH0gZWxzZSBpZiAob3B0cy5pZCkge1xuICAgICAgICBzcWwgKz0gJyBXSEVSRSAnICsgKG1vZGVsLmlkQXR0cmlidXRlID8gbW9kZWwuaWRBdHRyaWJ1dGUgOiBBTExPWV9JRF9ERUZBVUxUKSArICcgPSAnICsgKF8uaXNTdHJpbmcob3B0cy5pZCkgPyAnXCInICsgb3B0cy5pZCArICdcIicgOiBvcHRzLmlkKTtcbiAgICAgIH1cblxuICAgICAgLy8gZXhlY3V0ZSB0aGUgc2VsZWN0IHF1ZXJ5XG4gICAgICBkYiA9IGdldERhdGFiYXNlKGRiTmFtZSk7XG4gICAgICB2YXIgcnM7XG5cbiAgICAgIC8vIGlzIGl0IGEgc3RyaW5nIG9yIGEgcHJlcGFyZWQgc3RhdGVtZW50P1xuICAgICAgaWYgKF8uaXNTdHJpbmcoc3FsKSkge1xuICAgICAgICBycyA9IGRiLmV4ZWN1dGUoc3FsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJzID0gZGIuZXhlY3V0ZShzcWwuc3RhdGVtZW50LCBzcWwucGFyYW1zKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHZhbHVlcyA9IFtdO1xuICAgICAgdmFyIGZpZWxkTmFtZXMgPSBbXTtcbiAgICAgIHZhciBmaWVsZENvdW50ID0gXy5pc0Z1bmN0aW9uKHJzLmZpZWxkQ291bnQpID8gcnMuZmllbGRDb3VudCgpIDogcnMuZmllbGRDb3VudDtcbiAgICAgIHZhciBpID0gMDtcblxuICAgICAgZm9yICg7IGkgPCBmaWVsZENvdW50OyBpKyspIHtcbiAgICAgICAgZmllbGROYW1lcy5wdXNoKHJzLmZpZWxkTmFtZShpKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIGl0ZXJhdGUgdGhyb3VnaCBhbGwgcXVlcmllZCByb3dzXG4gICAgICB3aGlsZSAocnMuaXNWYWxpZFJvdygpKSB7XG4gICAgICAgIHZhciBvID0ge307XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBmaWVsZENvdW50OyBpKyspIHtcbiAgICAgICAgICBvW2ZpZWxkTmFtZXNbaV1dID0gcnMuZmllbGQoaSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFsdWVzLnB1c2gobyk7XG4gICAgICAgIHJzLm5leHQoKTtcbiAgICAgIH1cbiAgICAgIHJzLmNsb3NlKCk7XG5cbiAgICAgIC8vIHNoYXBlIHJlc3BvbnNlIGJhc2VkIG9uIHdoZXRoZXIgaXQncyBhIG1vZGVsIG9yIGNvbGxlY3Rpb25cbiAgICAgIHZhciBsZW4gPSB2YWx1ZXMubGVuZ3RoO1xuXG4gICAgICBpZiAoYmFja2JvbmUuVkVSU0lPTiA9PT0gJzAuOS4yJykge1xuICAgICAgICBtb2RlbC5sZW5ndGggPSBsZW47XG4gICAgICB9XG5cbiAgICAgIHJlc3AgPSBsZW4gPT09IDEgPyB2YWx1ZXNbMF0gOiB2YWx1ZXM7XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJ2RlbGV0ZSc6XG4gICAgICBzcWwgPSAnREVMRVRFIEZST00gJyArIHRhYmxlICsgJyBXSEVSRSAnICsgbW9kZWwuaWRBdHRyaWJ1dGUgKyAnPT8nO1xuXG4gICAgICAvLyBleGVjdXRlIHRoZSBkZWxldGVcbiAgICAgIGRiID0gZ2V0RGF0YWJhc2UoZGJOYW1lKTtcbiAgICAgIGRiLmV4ZWN1dGUoc3FsLCBtb2RlbC5pZCk7XG5cbiAgICAgIHJlc3AgPSBtb2RlbC50b0pTT04oKTtcbiAgICAgIGJyZWFrO31cblxuXG4gIC8vIHByb2Nlc3Mgc3VjY2Vzcy9lcnJvciBoYW5kbGVycywgaWYgcHJlc2VudFxuICBpZiAocmVzcCkge1xuICAgIGlmIChfLmlzRnVuY3Rpb24ob3B0cy5zdWNjZXNzKSkge29wdHMuc3VjY2VzcyhyZXNwKTt9XG4gICAgaWYgKG1ldGhvZCA9PT0gJ3JlYWQnICYmICFvcHRzLnNpbGVudCkge21vZGVsLnRyaWdnZXIoJ2ZldGNoJywgeyBmcm9tQWRhcHRlcjogdHJ1ZSB9KTt9XG4gIH0gZWxzZSB7XG4gICAgaWYgKF8uaXNGdW5jdGlvbihvcHRzLmVycm9yKSkge29wdHMuZXJyb3IocmVzcCk7fVxuICB9XG5cbn1cblxuLy8gR2V0cyB0aGUgY3VycmVudCBzYXZlZCBtaWdyYXRpb25cbmZ1bmN0aW9uIEdldE1pZ3JhdGlvbkZvcihkYm5hbWUsIHRhYmxlKSB7XG4gIHZhciBtaWQgPSBudWxsO1xuICB2YXIgZGIgPSBnZXREYXRhYmFzZShkYm5hbWUpO1xuICBkYi5leGVjdXRlKCdDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBtaWdyYXRpb25zIChsYXRlc3QgVEVYVCwgbW9kZWwgVEVYVCk7Jyk7XG4gIHZhciBycyA9IGRiLmV4ZWN1dGUoJ1NFTEVDVCBsYXRlc3QgRlJPTSBtaWdyYXRpb25zIHdoZXJlIG1vZGVsID0gPzsnLCB0YWJsZSk7XG4gIGlmIChycy5pc1ZhbGlkUm93KCkpIHtcbiAgICBtaWQgPSBycy5maWVsZCgwKSArICcnO1xuICB9XG4gIHJzLmNsb3NlKCk7XG4gIHJldHVybiBtaWQ7XG59XG5cbmZ1bmN0aW9uIE1pZ3JhdGUoTW9kZWwpIHtcbiAgLy8gZ2V0IGxpc3Qgb2YgbWlncmF0aW9ucyBmb3IgdGhpcyBtb2RlbFxuICB2YXIgbWlncmF0aW9ucyA9IE1vZGVsLm1pZ3JhdGlvbnMgfHwgW107XG5cbiAgLy8gZ2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBsYXN0IG1pZ3JhdGlvblxuICB2YXIgbGFzdE1pZ3JhdGlvbiA9IHt9O1xuICBpZiAobWlncmF0aW9ucy5sZW5ndGgpIHttaWdyYXRpb25zW21pZ3JhdGlvbnMubGVuZ3RoIC0gMV0obGFzdE1pZ3JhdGlvbik7fVxuXG4gIC8vIEdldCBjb25maWcgcmVmZXJlbmNlXG4gIHZhciBjb25maWcgPSBNb2RlbC5wcm90b3R5cGUuY29uZmlnO1xuXG4gIC8vIEdldCB0aGUgZGIgbmFtZSBmb3IgdGhpcyBtb2RlbCBhbmQgc2V0IHVwIHRoZSBzcWwgbWlncmF0aW9uIG9iZWpjdFxuICBjb25maWcuYWRhcHRlci5kYl9uYW1lID0gY29uZmlnLmFkYXB0ZXIuZGJfbmFtZSB8fCBBTExPWV9EQl9ERUZBVUxUO1xuICB2YXIgbWlncmF0b3IgPSBuZXcgTWlncmF0b3IoY29uZmlnKTtcblxuICAvLyBHZXQgdGhlIG1pZ3JhdGlvbiBudW1iZXIgZnJvbSB0aGUgY29uZmlnLCBvciB1c2UgdGhlIG51bWJlciBvZlxuICAvLyB0aGUgbGFzdCBtaWdyYXRpb24gaWYgaXQncyBub3QgcHJlc2VudC4gSWYgd2Ugc3RpbGwgZG9uJ3QgaGF2ZSBhXG4gIC8vIG1pZ3JhdGlvbiBudW1iZXIgYWZ0ZXIgdGhhdCwgdGhhdCBtZWFucyB0aGVyZSBhcmUgbm9uZS4gVGhlcmUnc1xuICAvLyBubyBtaWdyYXRpb25zIHRvIHBlcmZvcm0uXG4gIHZhciB0YXJnZXROdW1iZXIgPSB0eXBlb2YgY29uZmlnLmFkYXB0ZXIubWlncmF0aW9uID09PSAndW5kZWZpbmVkJyB8fFxuICBjb25maWcuYWRhcHRlci5taWdyYXRpb24gPT09IG51bGwgPyBsYXN0TWlncmF0aW9uLmlkIDogY29uZmlnLmFkYXB0ZXIubWlncmF0aW9uO1xuICBpZiAodHlwZW9mIHRhcmdldE51bWJlciA9PT0gJ3VuZGVmaW5lZCcgfHwgdGFyZ2V0TnVtYmVyID09PSBudWxsKSB7XG4gICAgdmFyIHRtcERiID0gZ2V0RGF0YWJhc2UoY29uZmlnLmFkYXB0ZXIuZGJfbmFtZSk7XG4gICAgbWlncmF0b3IuZGIgPSB0bXBEYjtcbiAgICBtaWdyYXRvci5jcmVhdGVUYWJsZShjb25maWcpO1xuICAgIHJldHVybjtcbiAgfVxuICB0YXJnZXROdW1iZXIgPSB0YXJnZXROdW1iZXIgKyAnJzsgLy8gZW5zdXJlIHRoYXQgaXQncyBhIHN0cmluZ1xuXG4gIC8vIENyZWF0ZSB0aGUgbWlncmF0aW9uIHRyYWNraW5nIHRhYmxlIGlmIGl0IGRvZXNuJ3QgYWxyZWFkeSBleGlzdC5cbiAgLy8gR2V0IHRoZSBjdXJyZW50IHNhdmVkIG1pZ3JhdGlvbiBudW1iZXIuXG4gIHZhciBjdXJyZW50TnVtYmVyID0gR2V0TWlncmF0aW9uRm9yKGNvbmZpZy5hZGFwdGVyLmRiX25hbWUsIGNvbmZpZy5hZGFwdGVyLmNvbGxlY3Rpb25fbmFtZSk7XG5cbiAgLy8gSWYgdGhlIGN1cnJlbnQgYW5kIHJlcXVlc3RlZCBtaWdyYXRpb25zIG1hdGNoLCB0aGUgZGF0YSBzdHJ1Y3R1cmVzXG4gIC8vIG1hdGNoIGFuZCB0aGVyZSBpcyBubyBuZWVkIHRvIHJ1biB0aGUgbWlncmF0aW9ucy5cbiAgdmFyIGRpcmVjdGlvbjtcbiAgaWYgKGN1cnJlbnROdW1iZXIgPT09IHRhcmdldE51bWJlcikge1xuICAgIHJldHVybjtcbiAgfSBlbHNlIGlmIChjdXJyZW50TnVtYmVyICYmIGN1cnJlbnROdW1iZXIgPiB0YXJnZXROdW1iZXIpIHtcbiAgICBkaXJlY3Rpb24gPSAwOyAvLyByb2xsYmFja1xuICAgIG1pZ3JhdGlvbnMucmV2ZXJzZSgpO1xuICB9IGVsc2Uge1xuICAgIGRpcmVjdGlvbiA9IDE7IC8vIHVwZ3JhZGVcbiAgfVxuXG4gIC8vIG9wZW4gZGIgZm9yIG91ciBtaWdyYXRpb24gdHJhbnNhY3Rpb25cbiAgdmFyIGRiID0gZ2V0RGF0YWJhc2UoY29uZmlnLmFkYXB0ZXIuZGJfbmFtZSk7XG4gIG1pZ3JhdG9yLmRiID0gZGI7XG4gIGRiLmV4ZWN1dGUoJ0JFR0lOOycpO1xuXG4gIC8vIGl0ZXJhdGUgdGhyb3VnaCBhbGwgbWlncmF0aW9ucyBiYXNlZCBvbiB0aGUgY3VycmVudCBhbmQgcmVxdWVzdGVkIHN0YXRlLFxuICAvLyBhcHBseWluZyBhbGwgYXBwcm9wcmlhdGUgbWlncmF0aW9ucywgaW4gb3JkZXIsIHRvIHRoZSBkYXRhYmFzZS5cbiAgaWYgKG1pZ3JhdGlvbnMubGVuZ3RoKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtaWdyYXRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAvLyBjcmVhdGUgdGhlIG1pZ3JhdGlvbiBjb250ZXh0XG4gICAgICB2YXIgbWlncmF0aW9uID0gbWlncmF0aW9uc1tpXTtcbiAgICAgIHZhciBjb250ZXh0ID0ge307XG4gICAgICBtaWdyYXRpb24oY29udGV4dCk7XG5cbiAgICAgIC8vIGlmIHVwZ3JhZGluZywgc2tpcCBtaWdyYXRpb25zIGhpZ2hlciB0aGFuIHRoZSB0YXJnZXRcbiAgICAgIC8vIGlmIHJvbGxpbmcgYmFjaywgc2tpcCBtaWdyYXRpb25zIGxvd2VyIHRoYW4gdGhlIHRhcmdldFxuICAgICAgaWYgKGRpcmVjdGlvbikge1xuICAgICAgICBpZiAoY29udGV4dC5pZCA+IHRhcmdldE51bWJlcikge2JyZWFrO31cbiAgICAgICAgaWYgKGNvbnRleHQuaWQgPD0gY3VycmVudE51bWJlcikge2NvbnRpbnVlO31cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChjb250ZXh0LmlkIDw9IHRhcmdldE51bWJlcikge2JyZWFrO31cbiAgICAgICAgaWYgKGNvbnRleHQuaWQgPiBjdXJyZW50TnVtYmVyKSB7Y29udGludWU7fVxuICAgICAgfVxuXG4gICAgICAvLyBleGVjdXRlIHRoZSBhcHByb3ByaWF0ZSBtaWdyYXRpb24gZnVuY3Rpb25cbiAgICAgIHZhciBmdW5jTmFtZSA9IGRpcmVjdGlvbiA/ICd1cCcgOiAnZG93bic7XG4gICAgICBpZiAoXy5pc0Z1bmN0aW9uKGNvbnRleHRbZnVuY05hbWVdKSkge1xuICAgICAgICBjb250ZXh0W2Z1bmNOYW1lXShtaWdyYXRvciwgY29uZmlnKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbWlncmF0b3IuY3JlYXRlVGFibGUoY29uZmlnKTtcbiAgfVxuXG4gIC8vIHVwZGF0ZSB0aGUgc2F2ZWQgbWlncmF0aW9uIGluIHRoZSBkYlxuICBkYi5leGVjdXRlKCdERUxFVEUgRlJPTSBtaWdyYXRpb25zIHdoZXJlIG1vZGVsID0gPycsIGNvbmZpZy5hZGFwdGVyLmNvbGxlY3Rpb25fbmFtZSk7XG4gIGRiLmV4ZWN1dGUoJ0lOU0VSVCBJTlRPIG1pZ3JhdGlvbnMgVkFMVUVTICg/LD8pJywgdGFyZ2V0TnVtYmVyLCBjb25maWcuYWRhcHRlci5jb2xsZWN0aW9uX25hbWUpO1xuXG4gIC8vIGVuZCB0aGUgbWlncmF0aW9uIHRyYW5zYWN0aW9uXG4gIGRiLmV4ZWN1dGUoJ0NPTU1JVDsnKTtcbiAgbWlncmF0b3IuZGIgPSBudWxsO1xufVxuXG5mdW5jdGlvbiBpbnN0YWxsRGF0YWJhc2UoY29uZmlnKSB7XG4gIC8vIGdldCB0aGUgZGF0YWJhc2UgbmFtZSBmcm9tIHRoZSBkYiBmaWxlIHBhdGhcbiAgdmFyIGRiRmlsZSA9IF8uaXNGdW5jdGlvbihjb25maWcuYWRhcHRlci5kYl9maWxlKSA/IGNvbmZpZy5hZGFwdGVyLmRiX2ZpbGUoY29uZmlnKSA6IGNvbmZpZy5hZGFwdGVyLmRiX2ZpbGU7XG4gIHZhciB0YWJsZSA9IGNvbmZpZy5hZGFwdGVyLmNvbGxlY3Rpb25fbmFtZTtcblxuICB2YXIgcnggPSAvKF58LipcXC8pKFteXFwvXSspXFwuW15cXC9dKyQvO1xuICB2YXIgbWF0Y2ggPSBkYkZpbGUubWF0Y2gocngpO1xuICBpZiAobWF0Y2ggPT09IG51bGwpIHtcbiAgICB0aHJvdyAnSW52YWxpZCBzcWwgZGF0YWJhc2UgZmlsZW5hbWUgXCInICsgZGJGaWxlICsgJ1wiJztcbiAgfVxuICAvL3ZhciBpc0Fic29sdXRlID0gbWF0Y2hbMV0gPyB0cnVlIDogZmFsc2U7XG4gIGNvbmZpZy5hZGFwdGVyLmRiX25hbWUgPSBjb25maWcuYWRhcHRlci5kYl9uYW1lIHx8IG1hdGNoWzJdO1xuICB2YXIgZGJOYW1lID0gY29uZmlnLmFkYXB0ZXIuZGJfbmFtZTtcblxuICAvLyBpbnN0YWxsIGFuZCBvcGVuIHRoZSBwcmVsb2FkZWQgZGJcbiAgVGkuQVBJLmRlYnVnKCdJbnN0YWxsaW5nIHNxbCBkYXRhYmFzZSBcIicgKyBkYkZpbGUgKyAnXCIgd2l0aCBuYW1lIFwiJyArIGRiTmFtZSArICdcIicpO1xuICB2YXIgZGIgPSBUaS5EYXRhYmFzZS5pbnN0YWxsKGRiRmlsZSwgZGJOYW1lKTtcbiAgY2FjaGUuZGJbZGJOYW1lXSA9IGRiO1xuXG4gIC8vIHNldCByZW1vdGVCYWNrdXAgc3RhdHVzIGZvciBpT1NcbiAgaWYgKGNvbmZpZy5hZGFwdGVyLnJlbW90ZUJhY2t1cCA9PT0gZmFsc2UgJiYgZmFsc2UpIHtcbiAgICBUaS5BUEkuZGVidWcoJ2lDbG91ZCBcImRvIG5vdCBiYWNrdXBcIiBmbGFnIHNldCBmb3IgZGF0YWJhc2UgXCInICsgZGJGaWxlICsgJ1wiJyk7XG4gICAgZGIuZmlsZS5zZXRSZW1vdGVCYWNrdXAoZmFsc2UpO1xuICB9XG5cbiAgLy8gY29tcG9zZSBjb25maWcuY29sdW1ucyBmcm9tIHRhYmxlIGRlZmluaXRpb24gaW4gZGF0YWJhc2VcbiAgdmFyIHJzID0gZGIuZXhlY3V0ZSgncHJhZ21hIHRhYmxlX2luZm8oXCInICsgdGFibGUgKyAnXCIpOycpO1xuICB2YXIgY29sdW1ucyA9IHt9LGNOYW1lLGNUeXBlO1xuICBpZiAocnMpIHtcbiAgICB3aGlsZSAocnMuaXNWYWxpZFJvdygpKSB7XG4gICAgICBjTmFtZSA9IHJzLmZpZWxkQnlOYW1lKCduYW1lJyk7XG4gICAgICBjVHlwZSA9IHJzLmZpZWxkQnlOYW1lKCd0eXBlJyk7XG4gICAgICBjb2x1bW5zW2NOYW1lXSA9IGNUeXBlO1xuXG4gICAgICAvLyBzZWUgaWYgaXQgYWxyZWFkeSBoYXMgdGhlIEFMTE9ZX0lEX0RFRkFVTFRcbiAgICAgIGlmIChjTmFtZSA9PT0gQUxMT1lfSURfREVGQVVMVCAmJiAhY29uZmlnLmFkYXB0ZXIuaWRBdHRyaWJ1dGUpIHtcbiAgICAgICAgY29uZmlnLmFkYXB0ZXIuaWRBdHRyaWJ1dGUgPSBBTExPWV9JRF9ERUZBVUxUO1xuICAgICAgfVxuXG4gICAgICBycy5uZXh0KCk7XG4gICAgfVxuICAgIHJzLmNsb3NlKCk7XG4gIH1cbiAgaWYgKE9iamVjdC5rZXlzKGNvbHVtbnMpLmxlbmd0aCA9PT0gMCkge1xuICAgIHZhciBpZEF0dHJpYnV0ZSA9IGNvbmZpZy5hZGFwdGVyLmlkQXR0cmlidXRlID8gY29uZmlnLmFkYXB0ZXIuaWRBdHRyaWJ1dGUgOiBBTExPWV9JRF9ERUZBVUxUO1xuICAgIGZvciAodmFyIGsgaW4gY29uZmlnLmNvbHVtbnMpIHtcbiAgICAgIGNOYW1lID0gaztcbiAgICAgIGNUeXBlID0gY29uZmlnLmNvbHVtbnNba107XG5cbiAgICAgIC8vIHNlZSBpZiBpdCBhbHJlYWR5IGhhcyB0aGUgQUxMT1lfSURfREVGQVVMVFxuICAgICAgaWYgKGNOYW1lID09PSBBTExPWV9JRF9ERUZBVUxUICYmICFjb25maWcuYWRhcHRlci5pZEF0dHJpYnV0ZSkge1xuICAgICAgICBjb25maWcuYWRhcHRlci5pZEF0dHJpYnV0ZSA9IEFMTE9ZX0lEX0RFRkFVTFQ7XG4gICAgICB9IGVsc2UgaWYgKGsgPT09IGNvbmZpZy5hZGFwdGVyLmlkQXR0cmlidXRlKSB7XG4gICAgICAgIGNUeXBlICs9ICcgVU5JUVVFJztcbiAgICAgIH1cbiAgICAgIGNvbHVtbnNbY05hbWVdID0gY1R5cGU7XG4gICAgfVxuICB9XG4gIGNvbmZpZy5jb2x1bW5zID0gY29sdW1ucztcblxuICAvLyBtYWtlIHN1cmUgd2UgaGF2ZSBhIHVuaXF1ZSBpZCBmaWVsZFxuICBpZiAoY29uZmlnLmFkYXB0ZXIuaWRBdHRyaWJ1dGUpIHtcbiAgICBpZiAoIV8uY29udGFpbnMoXy5rZXlzKGNvbmZpZy5jb2x1bW5zKSwgY29uZmlnLmFkYXB0ZXIuaWRBdHRyaWJ1dGUpKSB7XG4gICAgICB0aHJvdyAnY29uZmlnLmFkYXB0ZXIuaWRBdHRyaWJ1dGUgXCInICsgY29uZmlnLmFkYXB0ZXIuaWRBdHRyaWJ1dGUgKyAnXCIgbm90IGZvdW5kIGluIGxpc3Qgb2YgY29sdW1ucyBmb3IgdGFibGUgXCInICsgdGFibGUgKyAnXCJcXG4nICtcbiAgICAgICdjb2x1bW5zOiBbJyArIF8ua2V5cyhjb25maWcuY29sdW1ucykuam9pbignLCcpICsgJ10nO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBUaS5BUEkuaW5mbygnTm8gY29uZmlnLmFkYXB0ZXIuaWRBdHRyaWJ1dGUgc3BlY2lmaWVkIGZvciB0YWJsZSBcIicgKyB0YWJsZSArICdcIicpO1xuICAgIFRpLkFQSS5pbmZvKCdBZGRpbmcgXCInICsgQUxMT1lfSURfREVGQVVMVCArICdcIiB0byB1bmlxdWVseSBpZGVudGlmeSByb3dzJyk7XG5cbiAgICB2YXIgZnVsbFN0cmluZ3MgPSBbXSxcbiAgICBjb2xTdHJpbmdzID0gW107XG4gICAgXy5lYWNoKGNvbmZpZy5jb2x1bW5zLCBmdW5jdGlvbiAodHlwZSwgbmFtZSkge1xuICAgICAgY29sU3RyaW5ncy5wdXNoKG5hbWUpO1xuICAgICAgZnVsbFN0cmluZ3MucHVzaChuYW1lICsgJyAnICsgdHlwZSk7XG4gICAgfSk7XG4gICAgdmFyIGNvbHNTdHJpbmcgPSBjb2xTdHJpbmdzLmpvaW4oJywnKTtcbiAgICBkYi5leGVjdXRlKCdBTFRFUiBUQUJMRSAnICsgdGFibGUgKyAnIFJFTkFNRSBUTyAnICsgdGFibGUgKyAnX3RlbXA7Jyk7XG4gICAgZGIuZXhlY3V0ZSgnQ1JFQVRFIFRBQkxFICcgKyB0YWJsZSArICcoJyArIGZ1bGxTdHJpbmdzLmpvaW4oJywnKSArICcsJyArIEFMTE9ZX0lEX0RFRkFVTFQgKyAnIFRFWFQgVU5JUVVFKTsnKTtcbiAgICBkYi5leGVjdXRlKCdJTlNFUlQgSU5UTyAnICsgdGFibGUgKyAnKCcgKyBjb2xzU3RyaW5nICsgJywnICsgQUxMT1lfSURfREVGQVVMVCArICcpIFNFTEVDVCAnICsgY29sc1N0cmluZyArICcsQ0FTVChfUk9XSURfIEFTIFRFWFQpIEZST00gJyArIHRhYmxlICsgJ190ZW1wOycpO1xuICAgIGRiLmV4ZWN1dGUoJ0RST1AgVEFCTEUgJyArIHRhYmxlICsgJ190ZW1wOycpO1xuICAgIGNvbmZpZy5jb2x1bW5zW0FMTE9ZX0lEX0RFRkFVTFRdID0gJ1RFWFQgVU5JUVVFJztcbiAgICBjb25maWcuYWRhcHRlci5pZEF0dHJpYnV0ZSA9IEFMTE9ZX0lEX0RFRkFVTFQ7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMuYmVmb3JlTW9kZWxDcmVhdGUgPSBmdW5jdGlvbiAoY29uZmlnLCBuYW1lKSB7XG4gIC8vIHVzZSBjYWNoZWQgY29uZmlnIGlmIGl0IGV4aXN0c1xuICBpZiAoY2FjaGUuY29uZmlnW25hbWVdKSB7XG4gICAgcmV0dXJuIGNhY2hlLmNvbmZpZ1tuYW1lXTtcbiAgfVxuXG4gIC8vIGNoZWNrIHBsYXRmb3JtIGNvbXBhdGliaWxpdHlcbiAgaWYgKFwiYW5kcm9pZFwiID09PSAnbW9iaWxld2ViJyB8fCB0eXBlb2YgVGkuRGF0YWJhc2UgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgdGhyb3cgJ05vIHN1cHBvcnQgZm9yIFRpdGFuaXVtLkRhdGFiYXNlIGluIE1vYmlsZVdlYiBlbnZpcm9ubWVudC4nO1xuICB9XG5cbiAgLy8gaW5zdGFsbCBkYXRhYmFzZSBmaWxlLCBpZiBzcGVjaWZpZWRcbiAgaWYgKGNvbmZpZy5hZGFwdGVyLmRiX2ZpbGUpIHtpbnN0YWxsRGF0YWJhc2UoY29uZmlnKTt9XG4gIGlmICghY29uZmlnLmFkYXB0ZXIuaWRBdHRyaWJ1dGUpIHtcbiAgICBUaS5BUEkuaW5mbygnTm8gY29uZmlnLmFkYXB0ZXIuaWRBdHRyaWJ1dGUgc3BlY2lmaWVkIGZvciB0YWJsZSBcIicgKyBjb25maWcuYWRhcHRlci5jb2xsZWN0aW9uX25hbWUgKyAnXCInKTtcbiAgICBUaS5BUEkuaW5mbygnQWRkaW5nIFwiJyArIEFMTE9ZX0lEX0RFRkFVTFQgKyAnXCIgdG8gdW5pcXVlbHkgaWRlbnRpZnkgcm93cycpO1xuICAgIGNvbmZpZy5jb2x1bW5zW0FMTE9ZX0lEX0RFRkFVTFRdID0gJ1RFWFQgVU5JUVVFJztcbiAgICBjb25maWcuYWRhcHRlci5pZEF0dHJpYnV0ZSA9IEFMTE9ZX0lEX0RFRkFVTFQ7XG4gIH1cblxuICAvLyBhZGQgdGhpcyBjb25maWcgdG8gdGhlIGNhY2hlXG4gIGNhY2hlLmNvbmZpZ1tuYW1lXSA9IGNvbmZpZztcblxuICByZXR1cm4gY29uZmlnO1xufTtcblxubW9kdWxlLmV4cG9ydHMuYWZ0ZXJNb2RlbENyZWF0ZSA9IGZ1bmN0aW9uIChNb2RlbCwgbmFtZSkge1xuICAvLyB1c2UgY2FjaGVkIE1vZGVsIGNsYXNzIGlmIGl0IGV4aXN0c1xuICBpZiAoY2FjaGUuTW9kZWxbbmFtZV0pIHtcbiAgICByZXR1cm4gY2FjaGUuTW9kZWxbbmFtZV07XG4gIH1cblxuICAvLyBjcmVhdGUgYW5kIG1pZ3JhdGUgdGhlIE1vZGVsIGNsYXNzXG4gIE1vZGVsID0gTW9kZWwgfHwge307XG4gIE1vZGVsLnByb3RvdHlwZS5pZEF0dHJpYnV0ZSA9IE1vZGVsLnByb3RvdHlwZS5jb25maWcuYWRhcHRlci5pZEF0dHJpYnV0ZTtcbiAgTWlncmF0ZShNb2RlbCk7XG5cbiAgLy8gQWRkIHRoZSBNb2RlbCBjbGFzcyB0byB0aGUgY2FjaGVcbiAgY2FjaGUuTW9kZWxbbmFtZV0gPSBNb2RlbDtcblxuICByZXR1cm4gTW9kZWw7XG59O1xuXG5tb2R1bGUuZXhwb3J0cy5zeW5jID0gU3luYzsiXSwic291cmNlUm9vdCI6ImQ6XFxHSUFOVFxcd3cyXFxpbmV0dGliZWFjb25cXFJlc291cmNlc1xcYW5kcm9pZFxcYWxsb3lcXHN5bmMifQ==
